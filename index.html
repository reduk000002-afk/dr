<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Trust Wallet</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 600px; margin: 0 auto; }
        .btn { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; }
        .btn:hover { background: #0056b3; }
        .btn:disabled { background: #666; cursor: not-allowed; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .qr-container { background: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; }
        .uri-box { background: #333; padding: 10px; border-radius: 5px; margin: 10px 0; word-break: break-all; font-size: 12px; }
        .status { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: red; margin-right: 10px; }
        .status.connected { background: green; }
        .form-group { margin: 15px 0; }
        input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #444; background: #333; color: white; }
        .instructions { background: #3d3d3d; padding: 15px; border-radius: 5px; margin: 15px 0; font-size: 14px; }
        .mobile-warning { background: #ffc107; color: #000; padding: 10px; border-radius: 5px; margin: 10px 0; text-align: center; }
        .hidden { display: none; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        #qr-canvas { border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Trust Wallet</h1>
        
        <div class="card">
            <h3>–°—Ç–∞—Ç—É—Å: <span id="status-text">–û—Ç–∫–ª—é—á–µ–Ω–æ</span> <span class="status" id="status-indicator"></span></h3>
            <button class="btn" onclick="generateTrustWalletConnection()" id="connect-btn">üîó –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Trust Wallet</button>
            <div id="mobile-warning" class="mobile-warning hidden">
                <strong>üì≤ –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ!</strong><br>
                –ó–∞—Ç–µ–º –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –≤ Trust Wallet –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ.
            </div>
        </div>
        
        <div class="card hidden" id="qr-section">
            <h3>üì± QR-–∫–æ–¥ –¥–ª—è Trust Wallet:</h3>
            <div class="qr-container">
                <canvas id="qr-canvas" width="250" height="250"></canvas>
            </div>
            <div class="uri-box" id="uri-text"></div>
            <button class="btn" onclick="copyURI()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <button class="btn" onclick="startListening()" id="listen-btn">üëÇ –ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ</button>
            <div class="instructions">
                <strong>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>
                1. –û—Ç–∫—Ä–æ–π—Ç–µ <strong>Trust Wallet</strong> –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ<br>
                2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É <strong>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</strong><br>
                3. –í—ã–±–µ—Ä–∏—Ç–µ <strong>WalletConnect</strong><br>
                4. –ù–∞–∂–º–∏—Ç–µ <strong>"–ù–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"</strong><br>
                5. <strong>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥</strong> –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É<br>
                6. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
            </div>
        </div>
        
        <div class="card hidden" id="wallet-info">
            <h3>‚úÖ –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω!</h3>
            <p>–ê–¥—Ä–µ—Å: <span id="wallet-address"></span></p>
            <p>–°–µ—Ç—å: <span id="wallet-network">BNB Smart Chain</span></p>
            <p>–ë–∞–ª–∞–Ω—Å BNB: <span id="wallet-balance">0</span></p>
            
            <div class="form-group">
                <label>–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</label>
                <input type="text" id="receiver-address" placeholder="0x...">
            </div>
            
            <div class="form-group">
                <label>–°—É–º–º–∞ BNB:</label>
                <input type="number" id="amount" value="0.001" step="0.001" min="0">
            </div>
            
            <button class="btn" onclick="sendTransaction()" id="send-btn">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å BNB</button>
            <button class="btn" onclick="disconnectWallet()" style="background: #dc3545;">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
        </div>
        
        <div class="card">
            <h3>üîß –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</h3>
            <div class="instructions">
                <p><strong>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π):</strong></p>
                <ol>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ <strong>Trust Wallet</strong> –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ <strong>DApps</strong> (–≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞)</li>
                    <li>–í–≤–µ–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ Trust Wallet:<br>
                        <code id="dapp-url"></code></li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–ü–æ–¥–∫–ª—é—á–∏—Ç—å"</strong> –≤ Trust Wallet</li>
                </ol>
                <p><strong>–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –ø—Ä—è–º–æ–π –ª–∏–Ω–∫:</strong><br>
                <button class="btn" onclick="openTrustWallet()" style="margin: 10px 0;">üì± –û—Ç–∫—Ä—ã—Ç—å –≤ Trust Wallet</button></p>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è QR-–∫–æ–¥–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
        class SimpleQRCode {
            static generate(text, size = 250) {
                const canvas = document.getElementById('qr-canvas');
                const ctx = canvas.getContext('2d');
                
                // –û—á–∏—â–∞–µ–º canvas
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, size, size);
                
                // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç
                ctx.fillStyle = '#000000';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                
                // QR –∑–∞–≥–ª—É—à–∫–∞
                ctx.fillText('Trust Wallet', size/2, size/2 - 30);
                ctx.fillText('Connect', size/2, size/2);
                ctx.fillText(text.substring(0, 20) + '...', size/2, size/2 + 30);
                
                // –†–∏—Å—É–µ–º —Ä–∞–º–∫—É
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.strokeRect(10, 10, size-20, size-20);
                
                return canvas.toDataURL();
            }
        }
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const NETWORK = {
            chainId: 56, // BSC Mainnet
            name: 'BNB Smart Chain',
            symbol: 'BNB'
        };
        
        let provider = null;
        let signer = null;
        let userAddress = null;
        let connectionId = null;
        let isListening = false;
        let listenInterval = null;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è DApp
        document.getElementById('dapp-url').textContent = window.location.href;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
        if (isMobileDevice()) {
            document.getElementById('mobile-warning').classList.remove('hidden');
            document.getElementById('connect-btn').disabled = true;
            document.getElementById('connect-btn').textContent = 'üì± –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ';
        }
        
        function generateTrustWalletConnection() {
            try {
                console.log('–°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è Trust Wallet...');
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                connectionId = 'trust_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                const connectionLink = `trust://wc?uri=${encodeURIComponent(JSON.stringify({
                    type: 'trust_connect',
                    id: connectionId,
                    network: NETWORK.name,
                    chainId: NETWORK.chainId,
                    timestamp: Date.now(),
                    dapp: window.location.href
                }))}`;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                localStorage.setItem('trust_connection_id', connectionId);
                localStorage.setItem('trust_connection_time', Date.now().toString());
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º QR-–∫–æ–¥
                showQRCode(connectionLink);
                
                // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                startListening();
                
                alert('‚úÖ QR-–∫–æ–¥ —Å–æ–∑–¥–∞–Ω!\n\n1. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ Trust Wallet\n2. –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É"\n3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ Trust Wallet ‚Üí WalletConnect');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        function showQRCode(uri) {
            console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º QR-–∫–æ–¥ –¥–ª—è:', uri.substring(0, 50) + '...');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é
            document.getElementById('qr-section').classList.remove('hidden');
            document.getElementById('connect-btn').disabled = true;
            document.getElementById('connect-btn').textContent = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º URI
            document.getElementById('uri-text').textContent = uri;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π QR-–∫–æ–¥
            SimpleQRCode.generate(uri);
        }
        
        function startListening() {
            if (isListening) return;
            
            isListening = true;
            document.getElementById('listen-btn').disabled = true;
            document.getElementById('listen-btn').textContent = 'üëÇ –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ...';
            
            console.log('–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            listenInterval = setInterval(() => {
                checkConnection();
            }, 2000);
            
            alert('üîÑ –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...\n\n–ü–æ—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR-–∫–æ–¥–∞ –≤ Trust Wallet, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
        }
        
        function checkConnection() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ localStorage
            const connected = localStorage.getItem('trust_wallet_connected');
            const address = localStorage.getItem('trust_wallet_address');
            const connectionTime = localStorage.getItem('trust_connection_time');
            
            if (connected === 'true' && address && connectionTime) {
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ!
                console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ:', address);
                onWalletConnected(address);
                clearInterval(listenInterval);
                isListening = false;
            }
        }
        
        function onWalletConnected(address) {
            try {
                userAddress = address;
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å MetaMask –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
                if (typeof window.ethereum !== 'undefined') {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = provider.getSigner();
                } else {
                    // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–ø—Ä–æ–≤–∞–π–¥–µ—Ä
                    provider = new ethers.JsonRpcProvider('https://bsc-dataseed.binance.org/');
                    signer = null;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateUI(true);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                updateWalletInfo();
                
                // –°–∫—Ä—ã–≤–∞–µ–º QR —Å–µ–∫—Ü–∏—é
                document.getElementById('qr-section').classList.add('hidden');
                
                alert(`‚úÖ Trust Wallet –ø–æ–¥–∫–ª—é—á–µ–Ω!\n\n–ê–¥—Ä–µ—Å: ${address.substring(0, 6)}...`);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        function updateUI(connected) {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const walletInfo = document.getElementById('wallet-info');
            const connectBtn = document.getElementById('connect-btn');
            
            if (connected) {
                indicator.className = 'status connected';
                statusText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                statusText.className = 'success';
                walletInfo.classList.remove('hidden');
                connectBtn.disabled = true;
                connectBtn.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
            } else {
                indicator.className = 'status';
                statusText.textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ';
                statusText.className = '';
                walletInfo.classList.add('hidden');
                connectBtn.disabled = false;
                connectBtn.textContent = 'üîó –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Trust Wallet';
            }
        }
        
        async function updateWalletInfo() {
            if (!userAddress || !provider) return;
            
            try {
                // –ê–¥—Ä–µ—Å
                document.getElementById('wallet-address').textContent = 
                    userAddress.substring(0, 8) + '...' + userAddress.substring(userAddress.length - 6);
                
                // –ë–∞–ª–∞–Ω—Å
                const balance = await provider.getBalance(userAddress);
                document.getElementById('wallet-balance').textContent = 
                    ethers.formatEther(balance).substring(0, 8) + ' ' + NETWORK.symbol;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
                document.getElementById('wallet-balance').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
            }
        }
        
        async function sendTransaction() {
            if (!signer) {
                alert('–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω—É–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–¥–ø–∏—Å–∏');
                return;
            }
            
            const to = document.getElementById('receiver-address').value.trim();
            const amount = document.getElementById('amount').value;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (!to || to.length !== 42 || !to.startsWith('0x')) {
                alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è!');
                return;
            }
            
            if (!amount || parseFloat(amount) <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!');
                return;
            }
            
            try {
                alert('üì± –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...\n\n–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ Trust Wallet!');
                
                // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                const tx = await signer.sendTransaction({
                    to: to,
                    value: ethers.parseEther(amount),
                    chainId: NETWORK.chainId
                });
                
                alert(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\n\n–•—ç—à: ${tx.hash}\n\n–û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...`);
                
                // –ñ–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                const receipt = await tx.wait();
                
                alert(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!\n\n–ë–ª–æ–∫: ${receipt.blockNumber}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                await updateWalletInfo();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                
                let errorMsg = error.message;
                if (errorMsg.includes('user rejected') || errorMsg.includes('denied')) {
                    errorMsg = '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞';
                } else if (errorMsg.includes('insufficient funds')) {
                    errorMsg = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
                }
                
                alert('‚ùå –û—à–∏–±–∫–∞: ' + errorMsg);
            }
        }
        
        function copyURI() {
            const uriText = document.getElementById('uri-text').textContent;
            if (uriText) {
                navigator.clipboard.writeText(uriText)
                    .then(() => {
                        alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!\n\n–í—Å—Ç–∞–≤—å—Ç–µ –≤ Trust Wallet ‚Üí WalletConnect');
                    })
                    .catch(err => {
                        alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message);
                    });
            }
        }
        
        function openTrustWallet() {
            // –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ Trust Wallet
            const dappUrl = window.location.href;
            const trustUrl = `https://link.trustwallet.com/open_url?coin_id=714&url=${encodeURIComponent(dappUrl)}`;
            
            window.open(trustUrl, '_blank');
            
            alert('üì± –û—Ç–∫—Ä—ã–≤–∞—é Trust Wallet...\n\n–ï—Å–ª–∏ Trust Wallet –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ Trust Wallet –±—Ä–∞—É–∑–µ—Ä–µ:\n\n' + dappUrl);
        }
        
        function disconnectWallet() {
            if (listenInterval) {
                clearInterval(listenInterval);
            }
            
            // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            localStorage.removeItem('trust_wallet_connected');
            localStorage.removeItem('trust_wallet_address');
            localStorage.removeItem('trust_connection_id');
            localStorage.removeItem('trust_connection_time');
            
            provider = null;
            signer = null;
            userAddress = null;
            connectionId = null;
            isListening = false;
            
            updateUI(false);
            alert('‚úÖ –ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω');
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç Trust Wallet (–¥–ª—è –¥–µ–º–æ)
        function simulateTrustWalletConnection() {
            const demoAddress = '0x' + Array.from({length: 40}, () => 
                Math.floor(Math.random() * 16).toString(16)).join('');
            
            localStorage.setItem('trust_wallet_connected', 'true');
            localStorage.setItem('trust_wallet_address', demoAddress);
            
            alert('üîó –î–µ–º–æ: –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Trust Wallet\n\n–ê–¥—Ä–µ—Å: ' + demoAddress.substring(0, 6) + '...\n\n–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.');
        }
        
        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            const connected = localStorage.getItem('trust_wallet_connected');
            const address = localStorage.getItem('trust_wallet_address');
            
            if (connected === 'true' && address) {
                console.log('–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ');
                onWalletConnected(address);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –¥–µ–º–æ
            const demoBtn = document.createElement('button');
            demoBtn.className = 'btn';
            demoBtn.style.background = '#6f42c1';
            demoBtn.textContent = 'üîÑ –î–µ–º–æ: –ò–º–∏—Ç–∞—Ü–∏—è Trust Wallet';
            demoBtn.onclick = simulateTrustWalletConnection;
            document.querySelector('.card').appendChild(demoBtn);
        });
        
        // –î–ª—è Trust Wallet DApp –±—Ä–∞—É–∑–µ—Ä–∞
        if (isMobileDevice()) {
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ Trust Wallet, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è
            if (typeof window.ethereum !== 'undefined') {
                setTimeout(async () => {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        if (accounts && accounts.length > 0) {
                            userAddress = accounts[0];
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
                            localStorage.setItem('trust_wallet_connected', 'true');
                            localStorage.setItem('trust_wallet_address', userAddress);
                            
                            provider = new ethers.BrowserProvider(window.ethereum);
                            signer = await provider.getSigner();
                            
                            updateUI(true);
                            updateWalletInfo();
                            
                            alert('‚úÖ Trust Wallet –ø–æ–¥–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ DApp –±—Ä–∞—É–∑–µ—Ä!');
                        }
                    } catch (error) {
                        console.log('–ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:', error);
                    }
                }, 1000);
            }
        }
    </script>
</body>
</html>
