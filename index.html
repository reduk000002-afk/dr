<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>USDT BEP20 ‚Äî Trust Wallet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
<script src="https://unpkg.com/@walletconnect/sign-client/dist/index.umd.js"></script>

<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family:Arial, sans-serif;
  max-width:480px;
  margin:30px auto;
  padding:20px;
}
h2 { text-align:center; }
button {
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
  background:#26a17b;
  color:#fff;
}
input {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #333;
  background:#1a1a1a;
  color:#fff;
}
.box {
  background:#1c1c1c;
  padding:15px;
  border-radius:12px;
  margin-top:20px;
}
.small { font-size:13px; opacity:0.8; }
</style>
</head>

<body>

<h2>üí≤ USDT (BEP-20)</h2>

<button onclick="connectWallet()">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å Trust Wallet</button>

<div id="walletBox" class="box" style="display:none;">
  <p><b>–ê–¥—Ä–µ—Å:</b><br><span id="addr"></span></p>
  <p><b>–ë–∞–ª–∞–Ω—Å USDT:</b> <span id="balance">0</span></p>

  <hr>

  <input id="to" placeholder="–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è 0x..." />
  <input id="amount" type="number" step="0.01" placeholder="–°—É–º–º–∞ USDT" />

  <button onclick="sendUSDT()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å USDT</button>
</div>

<script>
/* ===== –ù–ê–°–¢–†–û–ô–ö–ò ===== */
const PROJECT_ID = "6035d04bd27909e21d106b345131f578";
const CHAIN_ID = "eip155:56"; // BNB Smart Chain
const USDT_ADDRESS = "0x55d398326f99059fF775485246999027B3197955";

const USDT_ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function transfer(address,uint256) returns (bool)"
];

let signClient, session, provider, signer, userAddress, usdt;

/* ===== CONNECT ===== */
async function connectWallet() {
  signClient = await window.SignClient.init({
    projectId: PROJECT_ID,
    metadata: {
      name: "USDT Sender",
      description: "Send USDT BEP20",
      url: window.location.origin,
      icons: []
    }
  });

  const res = await signClient.connect({
    requiredNamespaces: {
      eip155: {
        methods: ["eth_sendTransaction", "eth_sign", "personal_sign"],
        chains: [CHAIN_ID],
        events: []
      }
    }
  });

  window.open(
    "https://link.trustwallet.com/wc?uri=" + encodeURIComponent(res.uri),
    "_blank"
  );

  session = await res.approval();

  userAddress = session.namespaces.eip155.accounts[0].split(":")[2];

  provider = new ethers.BrowserProvider({
    request: async ({ method, params }) => {
      return signClient.request({
        topic: session.topic,
        chainId: CHAIN_ID,
        request: { method, params }
      });
    }
  });

  signer = await provider.getSigner();
  usdt = new ethers.Contract(USDT_ADDRESS, USDT_ABI, signer);

  document.getElementById("walletBox").style.display = "block";
  document.getElementById("addr").textContent = userAddress;

  updateBalance();
}

/* ===== BALANCE ===== */
async function updateBalance() {
  const bal = await usdt.balanceOf(userAddress);
  document.getElementById("balance").textContent =
    ethers.formatUnits(bal, 18) + " USDT";
}

/* ===== SEND USDT ===== */
async function sendUSDT() {
  const to = document.getElementById("to").value.trim();
  const amount = document.getElementById("amount").value;

  if (!ethers.isAddress(to)) {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å");
    return;
  }

  if (!amount || Number(amount) <= 0) {
    alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");
    return;
  }

  try {
    const value = ethers.parseUnits(amount, 18);

    const tx = await usdt.transfer(to, value, {
      gasLimit: 100000n
    });

    alert("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ Trust Wallet");

    await tx.wait();

    alert("‚úÖ USDT –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã");
    updateBalance();

  } catch (e) {
    console.error(e);
    if (e.code === 4001) {
      alert("–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞");
    } else {
      alert("–û—à–∏–±–∫–∞: " + e.message);
    }
  }
}
</script>

</body>
</html>
